<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Asteroids 3D</title>
    <link rel="stylesheet" href="style.css">
    <script id="vertex-shader" type="x-shader/x-vertex">
      attribute vec4 vPosition;

      uniform mat4 mvMatrix;
      uniform mat4 projMatrix;
      uniform float vColoringMode;

      varying vec3 texCoords;

      // lighting
      attribute vec3 vNormal;
      varying vec3 N, L, E;
      uniform vec4 lightPosition;


      void main() {

        if (vColoringMode == 0.0) {
          vec3 pos = (mvMatrix * vPosition).xyz;
          // festum ljósið
          // vec3 mvLightPos = mat3(mvMatrix) * lightPosition.xyz;

          // notum bara directional light : sól langt í burtu.
          L = normalize(lightPosition.xyz);
          E = -normalize(pos);
          // normalMatrix ekki að virka einhverra hluta vegna.
          N = normalize(mat3(mvMatrix) * vNormal);

          gl_Position = projMatrix * mvMatrix * vPosition;
        }
        else if (vColoringMode == 1.0) {
          gl_Position = projMatrix * mat4(mat3(mvMatrix)) * vPosition.xyzw;
        }
        else {
          gl_Position = projMatrix * mvMatrix * vPosition.xyzw;
        }


        texCoords = vPosition.xyz;
      }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
      precision mediump float;

      uniform samplerCube skybox;
      uniform float fColoringMode;
      uniform vec4 altColor;

      varying vec3 texCoords;

      // lighting
      uniform vec4 ambientProduct;
      uniform vec4 diffuseProduct;
      uniform vec4 specularProduct;
      uniform float shininess;
      varying vec3 N, L, E;

      void main() {
        if (fColoringMode == 0.0) {
          vec4 fColor;
          float LdotN = dot(L, N);

          vec3 H = normalize(L + E);
          vec4 ambient = ambientProduct;

          float Kd = max(LdotN, 0.0);
          vec4 diffuse = Kd * diffuseProduct;

          float Ks = pow(max(dot(N,H), 0.0), shininess);
          vec4 specular = Ks * specularProduct;

          if (LdotN < 0.0) specular = vec4(0.0, 0.0, 0.0, 1.0);

          fColor = ambient + diffuse + specular;
          fColor.a = 1.0;

          gl_FragColor = fColor;
        }
        else if (fColoringMode == 1.0) {
          gl_FragColor = textureCube(skybox, texCoords);
        }
        else if (fColoringMode == 2.0) {
          gl_FragColor = altColor;
        }
      }
    </script>
  </head>
  <body id="body">
    <div class="container">
      <canvas id="gl-canvas"></canvas>
      <div class="to-be-hidden">
        <p>xPos: <span id="xpos-display">0.0</span></p>
        <p>yPos: <span id="ypos-display">0.0</span></p>
        <p>zPos: <span id="zpos-display">0.0</span></p>
        <hr>
        <p>xAngle: <span id="xangle-display">0.0</span></p>
        <p>yAngle: <span id="yangle-display">0.0</span></p>
        <p>zAngle: <span id="zangle-display">0.0</span></p>
        <hr>
        <p>xLook: <span id="xlook-display">0.0</span></p>
        <p>yLook: <span id="ylook-display">0.0</span></p>
        <p>zLook: <span id="zlook-display">0.0</span></p>
      </div>
    </div>
    <div class="texture-container">
      <img src="textures/skybox/skyboxBk.jpg" id="skybox-back">
      <img src="textures/skybox/skyboxDN.jpg" id="skybox-down">
      <img src="textures/skybox/skyboxFT.jpg" id="skybox-front">
      <img src="textures/skybox/skyboxLF.jpg" id="skybox-left">
      <img src="textures/skybox/skyboxRT.jpg" id="skybox-right">
      <img src="textures/skybox/skyboxUP.jpg" id="skybox-up">
    </div>
    <script src="libs/initShaders.js" type="text/javascript"></script>
    <script src="libs/MV.js" type="text/javascript"></script>
    <script src="libs/webgl-utils.js" type="text/javascript"></script>
    <script src="libs/PlyReader.js" type="text/javascript"></script>
    <script src="Asteroids3D.js" type="text/javascript"></script>
  </body>
</html>
